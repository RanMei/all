<!DOCTYPE html>

<html>

<head>
	<title>canvas</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
	<style>
	* {margin:0;padding:0}
	canvas {
		width: 100%;
		max-width: 1000px;
	}
	</style>

	<script type="text/javascript" src="../js/rem.js"></script>
	<script>
	window.onload = function(){

		var config = {
			
			canvasWidth: 1000,
			canvasHeight: 1000,

			lineWidth: 15,
			circleCount: 50,
			circleColor: 'rgba(200,30,200,1)',
			circleMaxRadius: 400,
			circleFadingRate: 0.008
		}
		
		var $canvas = document.getElementById("mycanvas");
		var z = $canvas.getContext("2d");

		var $w,$h;
		function initCanvas(){
			$w = $canvas.width = config.canvasWidth;
			$h = $canvas.height = config.canvasHeight;
			z.lineWidth = config.lineWidth;
		};
		initCanvas();
		//window.addEventListener('resize',initCanvas)
		
		var $hue = 360;
		var $tick = 0;
		var circles = [];
		
		//$canvas.style.cssText = 'position:absolute;left:0;top:0;';
		console.log([$canvas]);

		z.lineCap="round";
		z.lineJoin="round";
		
		function Circle( x,y ){
			this.x = x;
			this.y = y;
			this.r = Math.round(config.circleMaxRadius*Math.random());
			this.alpha = 1;
			this.color = 'rgba(200,30,200,1)';
			this.tick = 0;
		};
		Circle.prototype = {
			step: function(){
				this.x+= Math.random()*6-3;
				this.y+= Math.random()*6-3;
				this.alpha -= config.circleFadingRate;
				this.color = 'rgba(10,30,200,'+this.alpha+')';
				this.tick++;
				this.draw();
			},
			draw: function(){
				//console.log( this );
				
				z.beginPath();
				z.strokeStyle = this.color;
				z.arc( this.x,this.y,this.r,0,2*Math.PI );
				z.stroke();
			}
		}
		
		function render(){
			window.requestAnimationFrame(render);
			if( circles.length<config.circleCount ){
				circles.push( new Circle( $w/2,$h/2/*Math.random()*$w,Math.random()*$h*/ ) );
			};
			z.globalCompositeOperation = 'source-over';
			z.fillStyle = 'rgba(0,0,0,0.5)';
			z.fillRect( 0,0,$w,$h );
			z.globalCompositeOperation = 'lighter';

			circles.map(function(elem,i){
				elem.step();
				if( elem.alpha<=0 ){
					circles.splice(i,1);
				}
			});
			$tick++;
		}
		render();
		//setInterval(render,10);

		mycanvas.addEventListener("mousedown",function(e){
			console.log(e)
			var x = e.offsetX*1000/Number( document.defaultView.getComputedStyle( mycanvas ).width.replace(/px/,'') );
			var y = e.offsetY*1000/Number( document.defaultView.getComputedStyle( mycanvas ).height.replace(/px/,'') );
			circles.push( new Circle( x,y ) );
		});
			
	};
		

	</script>
</head>


<body>

	<canvas id="mycanvas">

	</canvas>


</body>

</html>
